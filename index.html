<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZILA Vesting Portal</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>

<style>
:root{
  --bg:#050508;
  --purple:#7c5cff;
  --soft:#b5b5c7;
}
*{box-sizing:border-box;font-family:Inter}
body{
  margin:0;
  background:radial-gradient(1200px 800px at 50% 20%,#120f1f,#050508 60%);
  color:#fff;
  text-align:center;
}
.nav{
  padding:16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.logo{color:var(--purple);font-weight:700;letter-spacing:2px}
.links a{
  color:#fff;
  margin-left:12px;
  text-decoration:none;
  font-size:13px;
}
.hero{padding:30px 20px}
.card{
  max-width:420px;
  margin:0 auto;
  background:#0b0a13;
  padding:26px;
  border-radius:18px;
  box-shadow:0 0 40px #7c5cff33;
}
h1{font-size:26px;margin:6px 0}
p{font-size:14px;color:var(--soft)}
.badge{
  display:inline-block;
  padding:6px 12px;
  border-radius:12px;
  background:#7c5cff33;
  margin-bottom:10px;
  font-size:13px;
}
.btn{
  width:100%;
  padding:14px;
  margin-top:12px;
  border-radius:14px;
  border:none;
  font-weight:600;
}
.primary{background:linear-gradient(90deg,#ff9f1c,#ff3d81);color:#fff}
.outline{background:transparent;border:1px solid var(--purple);color:#fff}
.bar{background:#1a1830;border-radius:10px;overflow:hidden;margin-top:10px}
.bar-fill{height:10px;width:0%;background:linear-gradient(90deg,#7c5cff,#ff3d81)}
.data{font-size:13px;margin-top:8px;color:#a98bff}
.lock{color:#ff6b6b;font-weight:600;margin-top:10px}
.history{text-align:left;font-size:12px;margin-top:10px;max-height:120px;overflow:auto}
.history div{padding:4px 0;border-bottom:1px solid #ffffff10}
</style>
</head>

<body>

<div class="nav">
  <div class="logo">ZILA</div>
  <div class="links">
    <a id="web" target="_blank">Website</a>
    <a id="tw" target="_blank">X</a>
    <a id="tgch" target="_blank">Telegram</a>
    <a id="tgg" target="_blank">Group</a>
  </div>
</div>

<div class="hero">
  <div class="card">
    <div class="badge" id="role">Detecting role...</div>
    <h1 id="title">ZILA Vesting</h1>
    <p id="desc">Connect wallet to continue</p>

    <button class="btn outline" id="connect">Connect Wallet</button>

    <div class="data" id="wallet"></div>
    <div class="data" id="claimable"></div>

    <div class="bar"><div class="bar-fill" id="progress"></div></div>
    <div class="data" id="progressText"></div>

    <button class="btn primary" id="claim">Claim Vesting</button>
    <div class="lock" id="lock"></div>

    <div class="history" id="history"></div>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const CONTRACT_ADDRESS = "0xYOUR_CONTRACT_ADDRESS";
const CHAIN_ID = 137;

const TEAM_WALLET    = "0xTEAM_WALLET";
const PRESALE_WALLET = "0xPRESALE_WALLET";
const PRIVATE_WALLET = "0xPRIVATE_WALLET";

const WEBSITE_URL = "https://zila.ai";
const TWITTER_URL = "https://x.com/zilafondation";
const TG_CHANNEL  = "https://t.me/zilatoken";
const TG_GROUP    = "https://t.me/zila_group";

/* ===== SOCIAL ===== */
web.href=WEBSITE_URL;
tw.href=TWITTER_URL;
tgch.href=TG_CHANNEL;
tgg.href=TG_GROUP;

/* ===== ABI ===== */
const ABI=[
  "function claim()",
  "function vestedAmount(address) view returns(uint256)",
  "function vestings(address) view returns(uint256,uint256,uint256,uint256)",
  "event VestingClaimed(address,uint256)"
];

let provider,signer,contract,user;
const path=location.pathname;

/* ===== ROUTE ROLE ===== */
let expectedRole=null;
if(path==="/team") expectedRole="TEAM";
if(path==="/presale") expectedRole="PRESALE";
if(path==="/private") expectedRole="PRIVATE";
if(path==="/admin") expectedRole="ADMIN";

/* ===== CONNECT ===== */
connect.onclick=async()=>{
  if(!window.ethereum) return alert("Install wallet");
  provider=new ethers.BrowserProvider(window.ethereum);
  await provider.send("eth_requestAccounts",[]);
  signer=await provider.getSigner();
  user=await signer.getAddress();
  contract=new ethers.Contract(CONTRACT_ADDRESS,ABI,signer);

  wallet.innerText="Connected: "+user.slice(0,6)+"..."+user.slice(-4);

  detectRole();
  loadData();
  loadHistory();
};

/* ===== ROLE DETECT ===== */
function detectRole(){
  let role="Public";
  if(user.toLowerCase()===TEAM_WALLET.toLowerCase()) role="TEAM";
  if(user.toLowerCase()===PRESALE_WALLET.toLowerCase()) role="PRESALE";
  if(user.toLowerCase()===PRIVATE_WALLET.toLowerCase()) role="PRIVATE";
  document.getElementById("role").innerText=role;

  if(expectedRole && role!==expectedRole && expectedRole!=="ADMIN"){
    lock.innerText="âŒ Wrong wallet for this page";
    claim.disabled=true;
  }
}

/* ===== DATA ===== */
async function loadData(){
  const vested=await contract.vestedAmount(user);
  const v=await contract.vestings(user);
  const claimable=vested-v[1];
  const percent=v[0]>0?Number(vested*100n/v[0]):0;

  claimable.innerText="Claimable: "+ethers.formatUnits(claimable,18)+" ZILA";
  progress.style.width=percent+"%";
  progressText.innerText="Vested: "+percent+"%";
}

/* ===== CLAIM ===== */
claim.onclick=async()=>{
  try{
    const tx=await contract.claim();
    await tx.wait();
    loadData(); loadHistory();
  }catch(e){ alert("Claim failed"); }
};

/* ===== HISTORY ===== */
async function loadHistory(){
  const logs=await contract.queryFilter(contract.filters.VestingClaimed(user),-2000);
  history.innerHTML="<b>Claim History</b>";
  logs.reverse().slice(0,5).forEach(l=>{
    history.innerHTML+=`<div>+ ${ethers.formatUnits(l.args[1],18)} ZILA</div>`;
  });
}
</script>

</body>
</html>
